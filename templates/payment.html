{% extends "base.html" %}
{% block title %}–î–æ—Å—Ç—É–ø –¥–æ —Ç–µ—Å—Ç—É{% endblock %}
{% block content %}
<div class="content-section">
    <div class="container">
        <div class="payment-container">
            <div class="payment-card">
                <h2>üîë –ê–∫—Ç–∏–≤—É–π—Ç–µ –¥–æ—Å—Ç—É–ø</h2>
                <p style="margin: 1.5rem 0; font-size: 1.1rem;">–í–≤–µ–¥—ñ—Ç—å —Ç–µ—Å—Ç–æ–≤–∏–π –∫–æ–¥ –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü—ñ—ó:</p>
                <div class="test-code-section">
                    <input type="text" id="testCode" placeholder="–í–≤–µ–¥—ñ—Ç—å –∫–æ–¥" autocomplete="off">
                    <button class="btn btn-primary btn-large" id="activateBtn" style="width: 100%;">–ê–∫—Ç–∏–≤—É–≤–∞—Ç–∏ –¥–æ—Å—Ç—É–ø</button>
                </div>
                <p style="margin-top: 2rem; font-size: 0.95rem; color: #7F8C8D;">
                    üí° <strong>–¢–µ—Å—Ç–æ–≤–∏–π –∫–æ–¥:</strong> TEST2024<br>
                    –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Ü–µ–π –∫–æ–¥ –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Ç–∞ –ø–æ–≤–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø—É –¥–æ —Ç–µ—Å—Ç—É
                </p>
                <div style="margin-top: 2rem; padding: 1.5rem; background: #E3F2FD; border-radius: 12px; border-left: 4px solid #0066CC;">
                    <p style="color: #0066CC; font-weight: 600; margin-bottom: 0.5rem;">‚ú® –©–æ –≤–∏ –æ—Ç—Ä–∏–º–∞—î—Ç–µ?</p>
                    <ul style="padding-left: 1.5rem; list-style-position: inside;">
                        <li>‚úÖ –ü–æ–≤–Ω–∏–π –¥–æ—Å—Ç—É–ø –¥–æ 144 –ø–∏—Ç–∞–Ω—å —Ç–µ—Å—Ç—É</li>
                        <li>‚úÖ –î–µ—Ç–∞–ª—å–Ω—É —Ä–æ–∑—à–∏—Ñ—Ä–æ–≤–∫—É –≤–∞—à–æ–≥–æ —Ç–∏–ø—É</li>
                        <li>‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó –¥–ª—è —Ä–æ–∑–≤–∏—Ç–∫—É —Ç–∞ —Ä–æ—Å—Ç—É</li>
                        <li>‚úÖ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É –≤ PDF</li>
                        <li>‚úÖ –í—ñ–¥–µ–æ-–º–∞—Ç–µ—Ä—ñ–∞–ª–∏ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ —Ç–∏–ø—É (14 –≤—ñ–¥–µ–æ)</li>
                        <li>‚úÖ –ü–æ—Å—Ç—ñ–π–Ω–∏–π –¥–æ—Å—Ç—É–ø –ø—ñ—Å–ª—è –∞–∫—Ç–∏–≤–∞—Ü—ñ—ó</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
async function activate() {
    const code = document.getElementById('testCode').value.trim();
    if(!code) { alert('–í–≤–µ–¥—ñ—Ç—å –∫–æ–¥'); return; }
    try {
        const response = await fetch('/api/payment/verify', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({test_code: code})
        });
        const data = await response.json();
        if(data.success && data.session_id) {
            localStorage.setItem('enneagram_session', data.session_id);
            localStorage.removeItem('enneagram_result');
            localStorage.removeItem('enneagram_current_index');
            localStorage.removeItem('enneagram_answers');
            alert('‚úÖ –ö–æ–¥ –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–æ! –†–æ–∑–ø–æ—á–Ω—ñ—Ç—å —Ç–µ—Å—Ç.');
            window.location.href = '/test';
        } else {
            alert('‚ùå –ù–µ–≤—ñ—Ä–Ω–∏–π –∫–æ–¥! –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.');
        }
    } catch(e) {
        alert('‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ —Å–µ—Ä–≤–µ—Ä–∞');
    }
}
document.getElementById('activateBtn').addEventListener('click', activate);
document.getElementById('testCode').addEventListener('keypress', (e) => { if(e.key==='Enter') activate(); });
</script>
{% endblock %}
