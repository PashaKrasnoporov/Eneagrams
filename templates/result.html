{% extends "base.html" %}
{% block title %}–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Ç–µ—Å—Ç—É –ï–Ω–µ–∞–≥—Ä–∞–º–∏{% endblock %}
{% block content %}

<div class="result-container">
    <h1 class="result-title">‚ú® –í–ê–® –†–ï–ó–£–õ–¨–¢–ê–¢ ‚ú®</h1>
    <div class="result-card-main">
        <div class="type-badge">
            <div class="type-number" id="typeNumber">-</div>
        </div>

        <div class="type-info">
            <h2 class="type-name" id="typeName">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤...</h2>
            <p class="type-subtitle" id="typeSubtitle"></p>
        </div>

        <p class="type-short-desc" id="shortDescription"></p>

        <div class="characteristics-grid">
            <div class="characteristics-section">
                <h3>üí™ –°–∏–ª—å–Ω—ñ —Å—Ç–æ—Ä–æ–Ω–∏</h3>
                <p class="char-short" id="strengthsShort"></p>
                <ul id="strengths"></ul>
            </div>
            <div class="characteristics-section">
                <h3>üå± –û–±–ª–∞—Å—Ç—å —Ä–æ–∑–≤–∏—Ç–∫—É</h3>
                <p class="char-short" id="growthShort"></p>
                <ul id="growth"></ul>
            </div>
            <div class="characteristics-section">
                <h3>‚ù§Ô∏è –ú–æ—Ç–∏–≤–∞—Ü—ñ—ó</h3>
                <p class="char-short" id="motivationsShort"></p>
                <ul id="motivations"></ul>
            </div>
            <div class="characteristics-section">
                <h3>üò® –°—Ç—Ä–∞—Ö–∏</h3>
                <p class="char-short" id="fearsShort"></p>
                <ul id="fears"></ul>
            </div>
        </div>

        <div class="action-buttons">
            <a href="/full-description" class="btn btn-primary">üìñ –ü–æ–≤–Ω–∞ —Ä–æ–∑—à–∏—Ñ—Ä–æ–≤–∫–∞</a>
            <button class="btn btn-secondary" id="downloadPdfBtn">üìÑ –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ PDF</button>
            <button class="btn btn-secondary" id="emailBtn">üìß –ù–∞ email</button>
        </div>
    </div>
</div>

<script>
// === –í–Ü–î–û–ë–†–ê–ñ–ï–ù–ù–Ø –†–ï–ó–£–õ–¨–¢–ê–¢–£ ===
async function loadResult() {
    const sessionId = localStorage.getItem('enneagram_session');
    if (!sessionId) return;

    try {
        const response = await fetch(`/api/results/${sessionId}`);
        if (!response.ok) throw new Error('–ù–µ –∑–Ω–∞–π–¥–µ–Ω–æ');
        const result = await response.json();
        localStorage.setItem('enneagram_result', JSON.stringify(result));

        document.getElementById('typeNumber').textContent = result.personality_type;
        document.getElementById('typeName').textContent = result.type_name;
        document.getElementById('typeSubtitle').textContent = result.subtitle;
        document.getElementById('shortDescription').textContent = result.short_description;

        // –ö–æ—Ä–æ—Ç–∫—ñ –æ–ø–∏—Å–∏ –¥–ª—è 4 –±–ª–æ–∫—ñ–≤ (—è–∫—â–æ —î –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ)
        if (result.strengths_short) {
            document.getElementById('strengthsShort').textContent = result.strengths_short;
        }
        if (result.growth_short) {
            document.getElementById('growthShort').textContent = result.growth_short;
        }
        if (result.motivations_short) {
            document.getElementById('motivationsShort').textContent = result.motivations_short;
        }
        if (result.fears_short) {
            document.getElementById('fearsShort').textContent = result.fears_short;
        }

        function fillList(listId, items) {
            const el = document.getElementById(listId);
            el.innerHTML = '';
            if (items && Array.isArray(items)) {
                items.forEach(i => {
                    if (typeof i === 'string' && i.trim()) {
                        const li = document.createElement('li');
                        li.textContent = i;
                        el.appendChild(li);
                    }
                });
            }
        }

        fillList('strengths', result.strengths);
        fillList('growth', result.growth);
        fillList('motivations', result.motivations);
        fillList('fears', result.fears);

    } catch (e) {
        document.getElementById('typeName').textContent = '–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤';
    }
}

// === –ö–ù–û–ü–ö–ê PDF ===
document.getElementById('downloadPdfBtn').addEventListener('click', () => {
    const sessionId = localStorage.getItem('enneagram_session');
    window.location.href = `/api/results/${sessionId}/pdf`;
});

// === –ö–ù–û–ü–ö–ê EMAIL (–∑–∞–≥–ª—É—à–∫–∞) ===
document.getElementById('emailBtn').addEventListener('click', () => {
    const email = prompt('–í–≤–µ–¥—ñ—Ç—å –≤–∞—à email –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤:');
    if (email) alert('‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –±—É–¥—É—Ç—å –Ω–∞–¥—ñ—Å–ª–∞–Ω—ñ –Ω–∞ ' + email);
});

// === –°–¢–ê–†–¢ ===
loadResult();
</script>
{% endblock %}
